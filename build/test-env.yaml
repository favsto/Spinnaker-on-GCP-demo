steps:

# Compile
- name: 'gcr.io/cloud-builders/npm'
  args:
  - 'install'

# Test code
- name: 'gcr.io/cloud-builders/npm'
  args:
  - 'test'

# Build image
- name: 'gcr.io/cloud-builders/docker'
  entrypoint: 'sh'
  args:
  - '-c'
  - 'docker build --tag=eu.gcr.io/$PROJECT_ID/micro-backend:$(cat source/backend/version) --file=source/backend/Dockerfile ./source/backend/'

# release image
# Push the image
- name: 'gcr.io/cloud-builders/docker'
  entrypoint: 'sh'
  args:
  - '-c'
  - 'docker push eu.gcr.io/$PROJECT_ID/micro-backend:$(cat source/backend/version)'